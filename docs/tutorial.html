<!DOCTYPE html>
<html>
	<head>
		<title>LiberPHP2 Document</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="description" content="LiberPHP2 Document Preference">
		<link rel="stylesheet" href="css/docs.css" type="text/css" />
		<script></script>
		<script src="http://liberjs.org/liber.js"></script>
		<script src="js/docs.js"></script>
	</head>
	<body>
		<div id="wrapper">
		<nav>
			<h1>LiberPHP2</h1>
			<a href="index.html">About</a>
			<a href="">Tutorial</a>
			<a href="index.php?f=Core.inc">Document</a>
		</nav>
		<dl>
			<dd><a href="#@s_install">Installation</a></dd>
			<dd><a href="#@s_hello">Hello world !</a></dd>
			<dd><a href="#@s_restful">RESTful dispatching</a></dd>
			<dd><a href="#@s_db_model">DB, Model, Schema</a></dd>
			<dd><a href="#@s_cache">Use Cache</a></dd>
			<dd><a href="#@s_template">HTML Template</a></dd>
			<dd><a href="#@s_local">Localization(Multi-Lang)</a></dd>
			<dd><a href="#@s_auth">Filters & Auth</a></dd>
			<dd><a href="#@s_test">Unit Test</a></dd>
			<dd><a href="#@s_performance">Performance Test</a></dd>
			<dd><a href="#@s_next">What's Next?</a></dd>
		</dl>
		<article>
			<h2>Tutorial</h2>
			<section id="@s_install">
				<header>Requirement</header>
				<ul>
					<li>PHP 5.4 (with APC, GD2, Memcache(Memcached), PDO, pdo-mysql ...) </li>
					<li>Memcached</li>					
					<li>Smarty (optional)</li>					
				</ul>
				<header>Installation</header>
				<ul>
					<li>Check out from <a href="https://github.com/soyoes/liberphp2">here</a><br> 
						<code>
&gt; cd YOUR_HTTP_DOCUMENT_ROOT
&gt; git clone https://github.com/soyoes/liberphp2 liberphp2
						</code>
					</li>
				</ul>
			</section>
			<section id="@s_hello">
				<header>Hello world</header>
				<ol>
					<li>Create project
						<code>
&gt; cd YOUR_HTTP_DOCUMENT_ROOT/liberphp2
&gt; ./liberphp.php create myproj
&gt; cd ../myproj
						</code>
					</li>
					<li>Configurations
						<code>
&gt; vi conf/conf.inc
						</code>
						Change the following lines
						<code>
static $db_engine 	= "mysql";	#<- change to your own
static $db_host		= "127.0.0.1";	
static $db_port		= "3306";	
static $db_name		= "tasks";	#<- change to your own
static $db_user		= "root";	#<- change to your own
static $db_pass		= "root";	#<- change to your own
	
static $cache_hosts	= "localhost";	
static $cache_port	= "11211";	#<- change to your own
						</code>
					</li>
					<li>DB migration (Option)
					<code>		
&gt; php liber.php migrate #run this under your project folder
					</code>
					</li>
					
					<li>Update you Apache configuration<br>
						 Add these rows to your httpd.conf (or extra/httpd-vhosts.conf)
						<code>
&lt;VirtualHost *:80&gt;
    DocumentRoot "YOUR_PROJECT_PATH"
    Options FollowSymLinks
    ServerName YOUR_PROJECT_NAME.dev
    RewriteEngine on
    RewriteRule  images/(.*)$ /webroot/images/$1  [L]
    RewriteRule  css/(.*)$ /webroot/css/$1    [L]
    RewriteRule  js/(.*)$ /webroot/js/$1    [L]
    RewriteRule  ^(.*)\.html$ /webroot/html/$1.htm    [L]
    RewriteRule !\.(php|svg|ttf|htc|ico|gif|png|jpg|jpeg|css|js|swf|html|htm|json)$ /liber.php?__URL__=%{REQUEST_URI} [QSA,NE,L]<br>
&lt;/VirtualHost&gt;
						</code>
					</li>
					<li>Add virtural host IP to your hosts file
					<code> 
# /etc/hosts
127.0.0.1		YOUR_PROJECT_NAME.dev
					</code>
					</li>
					<li>Restart your apache</li>
					<li>Try it by accessing http://YOUR_PROJECT_NAME.dev</li>
				</ol>
			</section>
			<section id="@s_restful">
				<header>RESTful dispatching</header>
				<table>
					<tr>
						<th>URI<br>Pattern</th>
						<th>HTTP<br>Method</th>
						<th>Delegate<br>File</th>
						<th>Delegate<br>Function</th>
					</tr>
					<tr>
						<td>[/PATH]/CONTROLLER_NAME[/ID]</td>
						<td>
							GET<br>
							POST<br>
							PUT<br>
							DELETE
						</td>
						<td>controllers/CONTROLLER_NAME.inc</td>
						<td>
							get($params) <samp >//@see <a href="#@rest_example_1">example_1</a></samp><br>
							post($params) <samp >//@see <a href="#@rest_example_2">example_2</a></samp><br>
							put($params)<br>
							delete($params)<br>
						</td>
					</tr>
					<tr>
						<td>[/PATH]/CONTROLLER_NAME[/ID]/ACTION_NAME[/ID]</td>
						<td>
							GET<br>
							POST<br>
							PUT<br>
							DELETE
						</td>
						<td>controllers/CONTROLLER_NAME.inc</td>
						<td>ACTION_NAME($params) <samp >//@see <a href="#@rest_example_3">example_3</a></samp></td>
					</tr>
					<tr>
						<td>/@SCHEMA_NAME[/ID]</td>
						<td>
							GET<br>
							POST<br>
							PUT<br>
							DELETE
						</td>
						<td>restful/SCHEMA_NAME.inc
							<br>(Optional, you can do auth check or filtering here)</td>
						<td>
							get($params) <samp >//Optional, @see <a href="#@rest_example_4">example_4</a></samp><br>
							post($params) <samp >//Optional, @see <a href="#@rest_example_5">example_5</a></samp><br>
							put($params) <samp >//Optional, @see <a href="#@rest_example_6">example_6</a></samp><br>
							delete($params) //Optional<br>
						</td>
					</tr>
				</table>
				
				<div>
					<h4>Restful Request Query Commands</h4>
					<table>
						<tr>
							<th>Command<br>(browser)</th><th>Alias<br>(db_find)</th><th>Syntax</th><th>Example</th><th>Description</th>
						</tr>
						<tr><td>eq</td><td>=</td><td>
								${column_name}=${v}
							</td><td>
								<strong>browser :</strong>/@tasks?id=5<br>
								<strong>db_find :</strong>db_find("tasks", [id=&gt;5]);
							</td><td>equal
								<br><code>select * from tasks where id=5;</code>
							</td></tr>
						<tr><td>ne</td><td>!</td><td>
								<strong>browser :</strong>${column_name}@ne=${v}<br>
								<strong>db_find :</strong>[ "${column_name}@!" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@ne=5<br>
								<strong>db_find :</strong>db_find("tasks", ["id@!"=&gt;5]);
							</td><td>not equal
								<br><code>select * from tasks where id != 5;</code>
							</td></tr>
						<tr><td>lt</td><td>$lt;</td><td>
								<strong>browser: </strong>${column_name}@lt=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@&lt;" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@lt=5<br>
								<strong>db_find :</strong>db_find("tasks", ["id@&lt;"=&gt;5]);
							</td><td>less than
								<br><code>select * from tasks where id &lt; 5;</code>
							</td></tr>
						<tr><td>gt</td><td>$gt;</td><td>
								<strong>browser: </strong>${column_name}@gt=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@&gt;" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@gt=5<br>
								<strong>db_find :</strong>db_find("tasks", ["id@&gt;"=&gt;5]);
							</td><td>greate than
								<br><code>select * from tasks where id &gt; 5;</code>
							</td></tr>
						<tr><td>le</td><td>$le;</td><td>
								<strong>browser: </strong>${column_name}@le=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@&le;" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@le=5<br>
								<strong>db_find :</strong>db_find("tasks", ["id@&le;"=&gt;5]);
							</td><td>less than or equal
								<br><code>select * from tasks where id &le; 5;</code>
							</td></tr>
						<tr><td>ge</td><td>$ge;</td><td>
								<strong>browser: </strong>${column_name}@ge=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@&ge;" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@ge=5<br>
								<strong>db_find :</strong>db_find("tasks", ["id@&ge;"=&gt;5]);
							</td><td>greate than or equal
								<br><code>select * from tasks where id &ge; 5;</code>
							</td></tr>
						<tr><td>in</td><td>[]</td><td>
								<strong>browser: </strong>${column_name}@in=${v1,v2 ...} <br>
								<strong>db_find: </strong>[ "${column_name}@[]" =&gt; ${v1,v2 ...} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@in=5,6<br>
								<strong>db_find :</strong>db_find("tasks", ["id@[]"=&gt;[5,6]]);
							</td><td>sql in clause
								<br><code>select * from tasks where id in (5,6);</code>
							</td></tr>
						<tr><td>nin</td><td>![]</td><td>
								<strong>browser: </strong>${column_name}@nin=${v1,v2 ...} <br>
								<strong>db_find: </strong>[ "${column_name}@![]" =&gt; ${v1,v2 ...} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@nin=5,6<br>
								<strong>db_find :</strong>db_find("tasks", ["id@![]"=&gt;[5,6]]);
							</td><td>sql not in clause
								<br><code>select * from tasks where id not in (5,6);</code>
							</td></tr>
						<tr><td>bt</td><td>()</td><td>
								<strong>browser: </strong>${column_name}@bt=${v1,v2} <br>
								<strong>db_find: </strong>[ "${column_name}@!()" =&gt; ${v1,v2} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@bt=5,20<br>
								<strong>db_find :</strong>db_find("tasks", ["id@!()"=&gt;[5,20]]);
							</td><td>sql between
								<br><code>select * from tasks where id between (5,20);</code>
							</td></tr>
						<tr><td>nb</td><td>!()</td><td>
								<strong>browser: </strong>${column_name}@nb=${v1,v2} <br>
								<strong>db_find: </strong>[ "${column_name}@!()" =&gt; ${v1,v2} ]
							</td><td>
								<strong>browser :</strong>/@tasks?id@nb=5,20<br>
								<strong>db_find :</strong>db_find("tasks", ["id@!()"=&gt;[5,20]]);
							</td><td>sql not between
								<br><code>select * from tasks where id not between (5,20);</code>
							</td></tr>
						<tr><td>l</td><td>?</td><td>
								<strong>browser: </strong>${column_name}@l=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@?" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?title@l=abc<br>
								<strong>db_find :</strong>db_find("tasks", ["title@?"=&gt;"abc"]);
							</td><td>sql like
								<br><code>select * from tasks where title like '%abc%';</code>
							</td></tr>
						<tr><td>nl</td><td>!?</td><td>
								<strong>browser: </strong>${column_name}@nl=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@!?" =&gt; ${v} ]
							</td><td>
								<strong>browser :</strong>/@tasks?title@nl=abc<br>
								<strong>db_find :</strong>db_find("tasks", ["title@!?"=&gt;"abc"]);
							</td><td>sql not like
								<br><code>select * from tasks where title not like '%abc%';</code>
							</td></tr>
						<tr><td>m<b>(TODO)</b></td><td>~</td><td>
								<strong>browser: </strong>${column_name}@m=${v} <br>
								<strong>db_find: </strong>[ "${column_name}@~" =&gt; ${v} ]
							</td><td>
								<strong>db_find :</strong>db_find("tasks", ["title@~"=&gt;"abc|bcd"]);
							</td><td>sql regex match
								<br><b>mysql/postgres only</b>
								<br>For MySQL : these are available : 
								<br><b>^ , $ , . , [...] , [^...] , p1|p2|p3 , * , + , {n} , {m,n}</b>
								<br>MySQL example
								<br><code>select * from tasks where title regexp 'abc|bcd';</code> 
							</td></tr>
						<tr><td>nm<b>(TODO)</b></td><td>!~</td><td>
								<strong>db_find: </strong>[ "${column_name}@&lt;" =&gt; ${v} ]
							</td><td>
								<strong>db_find :</strong>db_find("tasks", ["id@&lt;"=&gt;5]);
							</td><td>sql regex not match<br>mysql/postgres only</td></tr>
						<tr><td>mi<b>(TODO)</b></td><td>~~</td><td>
								<strong>db_find: </strong>[ "${column_name}@&lt;" =&gt; ${v} ]
							</td><td>
								<strong>db_find :</strong>db_find("tasks", ["id@&lt;"=&gt;5]);
							</td><td>sql regex match(ignore case)<br>mysql/postgres only</td></tr>
						<tr><td>nmi<b>(TODO)</b></td><td>!~~</td><td>
								<strong>db_find: </strong>[ "${column_name}@&lt;" =&gt; ${v} ]
							</td><td>
								<strong>db_find :</strong>db_find("tasks", ["id@&lt;"=&gt;5]);
							</td><td>sql regex not match(ignore case)<br>mysql/postgres only</td></tr>
					</table>
				</div>
				
				<div>
					<h4>Customize Your Restful Request Permissions</h4>
					<div>
						<h4>Use schema file</h4>
						<p>
						@see : [general][restful] of chapter <a href="#@s_db_model_schema">DB, Model, Schema</a> 
						</p>
					</div>
					<div>
						<h4>Use delegate</h4>
						<p>
						</p>
					</div>
				</div>
				
				
				<div id="@rest_example_1" class="example">
					<h4>Example_1 : Call controller with default action using GET method</h4>
					<p>Given that the URI = /mycontroller?id=1&name=sss</p>
					<p>Your controller file (path = controllers/mycontroller.inc) </p>
					<code>
&lt;?php
	function get($params){
		//all request parameters are encapsulated in $params
		render_json($params);
		//also you can use render_html(with smarty) 
		//or render_text to send plain text 
	}
?&gt;
					</code>
					<p>The result will be : </p>
					<code>
{"id":1,"name":"sss"}
					</code>
				</div>
				<div id="@rest_example_2" class="example">
					<h4>Example_2 : Call controller with default action using POST method</h4>
					<code>
#in your html with jquery 
&lt;script&gt;
$.post('/mycontroller',{id:1,title:"blah blah..."});
&lt;/script&gt;

#in your controllers/mycontroller.inc
&lt;?php
...
	function post($params){
		//all request parameters are encapsulated in $params
		render_json($params); //params = {id:1,title:"blah blah..."}
	}
					</code>
				</div>
				<div id="@rest_example_3" class="example">
					<h4>Example_3 : Call controller with action name</h4>
					<code>
# call mycontroller/myaction?name=php
# in your controllers/mycontroller.inc
&lt;?php
...
	function myaction($params){
		render_text($params["name"]);
	}
#the result will be "php"
					</code>
				</div>
				<div id="@rest_example_4" class="example">
					<h4>Example_4 : Use automatical RESTful mechanism to GET data</h4>
					<code>
#Get newest 20 tasks from tasks table
&gt; curl http://myproj.dev/@tasks?order=desc&sort=updAt&limit=20

#Get tasks that title like '%test%' and register after 2013-10-30
&gt; curl http://myproj.dev/@tasks?title@l=test&amp;regAt@gt=2013-10-30

#Get task with id=35
&gt; curl http://myproj.dev/@tasks/35

#you don't need to write server code, liberPHP does this for you.
					</code>
				</div>
				<div id="@rest_example_5" class="example">
					<h4>Example_5 : Use automatical RESTful mechanism to POST new record</h4>
					<code>
#in your html with jquery 
&lt;script&gt;
$.post('/@tasks',{title:"blah blah..."});
&lt;/script&gt;

#the result will be 
{id:75, title:"blah blah... "} //75 is the last insert id

#you don't need to write server code, liberPHP does this for you.
					</code>
				</div>
				<div id="@rest_example_6" class="example">
					<h4>Example_6 : Use automatical RESTful mechanism to Update record</h4>
					<code>
#in your html with jquery 
&lt;script&gt;
$.put('/@tasks/75',{title:"blah new"}); //you must use PUT method here
&lt;/script&gt;

#the result will be 
{id:75, title:"blah new"} 

#you don't need to write server code, liberPHP does this for you. 
					</code>
				</div>
				<div id="@rest_example_7" class="example">
					<h4>Example_7 : Use automatical RESTful mechanism with filter</h4>
					<p>if you want to do permision check upon auto RESTful request<br>
						you may just simply add delegate methods under /restful/YOUR_SCHEMA.inc
					</p>
					
					<code>
#in your html with jquery 
&lt;script&gt;
$.put('/@tasks/75',{title:"blah new"}); //you must use PUT method here
&lt;/script&gt;

#in your restful/tasks.inc
&lt;?php

/**
* Delegate method, 
* the name must obey the rules of rest_{SCHEMA_NAME}_{METHOD_NAME}
* @param $table: tablename
* @param $params: http request params
*/
function rest_tasks_post($table, $params){ 
	if(!isset($_SESSION["userId"])) //e.g. for login user only
		return false;
	return true;
}

#if the is not loged in then the result will be 
{code:401, message:"RESTful ERROR : Sorry, You are not permited to do that."} 
					</code>
				</div>
				
			</section>
			<section id="@s_db_model">
				<header>DB & Model & Schema</header>
				<div  id="@s_db_model_schema">
					<h4>Schema (DB table definations)</h4>
					<p>You must tell liberPHP about your db schemas before you use db functions.
					<br>the schema files are under PROJ_HOME/conf/schemas/*.ini
					<br>Here is a very simple example. of file PROJ_HOME/conf/schemas/tasks.ini
					</p>
					<code>
[general]
name = tasks				//table name = tasks
pk = id					//primary key = id
restful = "get,post"		//permit http get/post restful request.
							//all : permit all
							//none : disable auto restful

[schema]
id 			= "BIGINT NOT NULL AUTO_INCREMENT"
ownerId		= "BIGINT NOT NULL"
title		= "varchar(256)"					

[index]
ownerId 	= "normal"		//create index on ownerId
					</code>
					
				</div>
				
				<div>
					<h4>DB Migration</h4>
					<p>After defined schema files. You can create tables using migrate method via command line. 
					<br><b>NOTICE:</b> for this moment. you have to create database and db user manually.
					</p>
					<code>
&gt; php liber.php migrate
					</code>
				</div>
				
				<div>
					<h4>DB Query</h4>
					<code>
/* 
* if useCache == true
* 	we will get result from Cache first.with $sql as key
* 	if there is no data in cache. the result from db will be add to cache
* @see <a>Use Cache</a> for more information
*/
$res = db_query($sql,$useCache=false); //$res is assoc-array 
					</code>
				</div>
				<div>
					<h4>DB Query With Condition</h4>
					<code>
/*
* syntax : db_find(tablename, conditions);
* @see <a href="index.php?f=DB.inc">DB.inc</a> for more information about conditions.
*/
$res = db_find("tasks", [
	"@fields" => "id",
	"regAt@>" => "2013-10-30",
	"title@?" => "Milk",
]);
//=select id from tasks where regAt>'2013-10-30' and title like '%Milk%' 					
					</code>
					<h5>DB Query With Model</h5>
					<code>
$m = Model::factory("tasks");
$res = $m->find(["regAt@>"=>'2013-10-30']);					
					</code>
				</div>
				<div>
					<h4>DB Insert & Update</h4>
					<code>
db_save('tasks',[title=>'My New Task'],true);
//=insert into tasks (title,regAt) values('My New Task',$now);
//returns [title='My New Task',id:5,regAt:$now]

db_save('tasks',[id=>3, title=>'New title']);
//=update tasks set title='New title' where id=3 					
					</code>
					<h5>DB Insert/Update With Model</h5>
					<code>
$m = Model::factory("tasks");
$m->fetch(3); //fetch data where id=3
$m->set("title","New Title With Model");
$m->save(); 
//=update tasks set title='New title With Model' where id=3 
					
					</code>
				</div>
				<div>
					<h4>DB Insert Multiple Rows</h4>
					<code>
db_import("tasks",[
	[title=>"task1"],
	[title=>"task2",priority=>1],
	[title=>"task3"]
]);
//=Insert into tasks (title,priority,regAt) 
// values ("tasks1",0,$now),("tasks2",1,$now),("tasks3",0,$now) 					
					</code>
				</div>
				<div>
					<h4>DB Transaction</h4>
					<code>
$res = db_trans([
	"insert into tasks (title) values ('my title')", 
	"select LAST_INSERT_ID() as 'last_id'"
]);
$id = $res[0]["last_id"];
//insert into db and get the last inserted id;
//if there are errors, db->rollback will be called automatically
					</code>
				</div>
			</section>
			<section id="@s_cache">
				<header>Use Cache</header>
				<ul>
				<li>We use both APC & Memcached as our cache system 
				<code>
//get from cache
/**
@param $callback: a function returns value of $key, it is used when $key not exists in APC or Memcache 
@param $use_memcache: true means get from APC first then Memcache. false=APC only 
*/
cache_get($key, $callback, $use_memcache=true){}

cache_set($key, $value, $use_memcache=true){}

/** @see <a href="index.php?f=Caches.inc">Cache.inc</a> for more informations*/
				</code>	
				</li>
				</ul>
			</section>
			<section id="@s_template">
				<header>HTML Template</header>
				<ul>
				<li>LiberPHP2 provides a lightway & very fast HTML render.
					<div>There are only less than 10 kinds of keywords/syntax, <br>
					if you have the expierence of Smarty or other html templates, it will be very easy to understand.</div>
					<div>
						<h4>Template File Path</h4>
						<p>The HTML render compiles your template files to equivalent php file and cache them under <b>PROJECT_HOME/tmp</b> 
							<br>The template file path</p>
						<code>
PROJECT_HOME/views/{$CLIENT_TYPE}/{$CONTROLLER_NAME}_{$ACTION_NAME}.html
/*
CLIENT_TYPE : depends where the request comes from. 
	type could be one of the following types.
	* pc : request from a PC browser
	* sm : request from smartphone, such as iPhone, iPod touch, Android
	* pad : request from iPad or some brands of Android such like Galaxy...
	* bot : a bot(spider) from google, Yahoo ... 					
*/
						</code>
						<h4>The Layout File</h4>
						<p>You can specify a layout file for certain kinds of template
							<br>the file should be found as <b>/views/{$CLIENT_TYPE}/_layout.html</b>
							<br>the content of layout file should have a preserved keyword called <b>__CONTENTS__</b> 
							<br>without <b>__CONTENTS__</b> the contents fetched from the template file won't be rendered.
							<br>Here is the example of a layout file
						</p>
						<code>
&lt;html&gt;
	&lt;head&gt;
	&lt;title&gt;LiberPHP2&lt;/title&gt;
	&lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; 
	&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;
	&lt;meta name="description" content=""&gt;
	&lt;link rel="stylesheet" href="/css/my_css.css" type="text/css" /&gt;
	&lt;script src="/js/my_js.js"&gt;&lt;/script&gt;
	&lt;/head&gt;
	&lt;body&gt;
	__CONTENTS__
	&lt;/body&gt;
&lt;/html&gt;
						</code>
						
						<h4>Compiled php file path</h4>
						<code>PROJECT_HOME/views/{$CLIENT_TYPE}/template-{$CONTROLLER_NAME}_{$ACTION_NAME}.php</code>
					</div>
					
					<div>
						<h4>Keywords & Syntax</h4>
						<table>
							<tr>
								<th>Keywords/Syntax</th><th>Example</th><th>Equivalent PHP code</th><th>Description</th>
							</tr>
							<tr>
								<td>{$VAR_NAME}</td><td><code>{$myVar}</code></td><td><code>echo $myVar;</code></td><td>echo a php variable</td>
							</tr>
							<tr>
								<td>{% KEY_NAME}</td>
								<td><code>{% myfile.mykey}</code></td>
								<td><code>T("myfile.mykey");</code></td><td>echo localized string</td>
							</tr>
							<tr>
								<td>{var}</td><td><code>{var $myvar=1}</code></td><td><code>$myvar=1;</code></td><td>declare a local php variable</td>
							</tr>
							<tr>
								<td>{if}, {elseif}, {else}</td>
								<td>
								<code>
{if $myvar>100}
	larger than 100
{elseif $myvar<1}
	less than 1
{else}
	others
								</code>
								</td>
								<td>
									<code>
if($myvar>100) 
	echo "larger than 100";
elseif($myvar<1) 
	echo "less than 1";
else 
	echo "others";</code>
									</td><td>if else ... clause</td>
							</tr>
							<tr>
								<td>{for}, {break}</td>
								<td>
								<code>
/*
given that 
$arr=[ 
	[title=>"title1"],
	[title=>"title2"]
	...
]
*/
{for $arr,$item}
	{$item.title}
{/for}
								</code></td>
								<td>
								<code>
foreach($arr as $item)
	echo $item["title"];
								</code>
								</td>
								<td>foreach, for ... break clause</td>
							</tr>
							<tr>
								<td>{ignore}</td>
								<td>
									<code>
&lt;script&gt;
{ignore}
var myJSVar = {id:"myId"};
{/ignore}
&lt;script&gt;
									</code>
								</td>
								<td>
									<code>
$code = &lt;&lt;&lt;EOF
&lt;script&gt;
var myJSVar = {id:"myId"};
&lt;script&gt;
EOF;
echo $code; 
									</code>
								</td><td>ignore keywords</td>
							</tr>
							<tr>
								<td>{include}</td>
								<td>
									<code>
{include 'myfile.html'}
									</code>
								</td>
								<td>
								</td><td>include other templates</td>
							</tr>
							<tr>
								<td>{comment}<b>(TODO)</b></td><td></td><td></td><td><b>TODO</b> not available yet</td>
							</tr>
						</table>
					</div>
					<div>
						<h4>To Assign Values & render</h4>
						<code>
//in your controller file : /controllers/mycontroller.inc
function myaction($params){
	assign('myvar_1', "val_1");
	render_html(null, [my_var2 =&gt; "val_2"]); //null means use default template name : mycontroller_myaction.html
}

//in your template file : /views/pc/mycontroller_myaction.html
&lt;div&gt;{$myvar_1}&lt;/div&gt;
&lt;div&gt;{$myvar_2}&lt;/div&gt;

//the result will be something like
&lt;div&gt;val_1&lt;/div&gt;
&lt;div&gt;val_2&lt;/div&gt;
						</code>
					</div>	
				</li>
				</ul>
			</section>
			
			<section id="@s_local">
				<header>Localization</header>
				<ul>
				<li>LiberPHP2 provides a very simple way to support multi-languages. 
				<code>
//in your conf/conf.inc
Consts::$lang = "en";

//in your text file : /conf/text/en/file1.ini
key1 = foo
key3 = bar

//in your text file : /conf/text/en/mycontroller.ini
key2 = hello

				
//in your controller file : /controllers/mycontroller.inc
function myaction($params){
	assign('myvar_1', T("file1.key1"));
	assign('myvar_2', T("key2")); //if no file name, render will try to use /conf/text/en/mycontroller.ini 
	render_html();
}

//in your template file : /views/pc/mycontroller_myaction.html
{$myvar_2}, {$myvar_1} {% file1.key3}

//the result will be
hello, foo bar 


				</code>	
				</li>
				</ul>
			</section>
			<section id="@s_auth">
				<header>Auth</header>
				<ol>
				<li>Under standing Filters
					<code>
If you have the exp of playing with J2EE servlet.
You could be familiar with the following process.

-> 1st filter->start()
	-> 2nd filter->start()
		-> nth filter->start()
		 	-> CONTROLLER.inc :: ACTION($params)
		-> nth filter->end()
	-> 2nd filter->end()
-> 1st filter->end()

We Use Filters to check Auth
					</code>
				</li>
				<li>AuthFilter Example
					<div>
						<h4>Configuration</h4>
						<code>
//in your conf/conf.inc
static $filters				= ['auth'=>'*'];					
						</code>
					</div>
					<div>
						<h4>Add a authfilter class</h4>
						<code>
//file : /filters/auth.inc
&lt;?php
class AuthFilter extends Filter{
	/**
	@param $params : parameters of your http request.
	@param $authRequired: depends on your controller file->$auth_action
	*/
	public function before($params, $authRequired){
		if($authRequired && !($_SESSION['user_id'])){
			return false;
		}
		return true;
	}
}
						</code>			
					</div>	
				</li>
				</ol>
			</section>
			<section id="@s_test">
				<header>Unit Test</header>
				<ol>
					<li>Create test case file under /test with a name of ${YOUR_CONTROLLER}_${YOUR_ACTION}.csv</li> 
  					<li>Add test case to /test/${YOUR_CONTROLLER}_${YOUR_ACTION}.csv<br>
 						<div>
  						<h4>Example of CSV:</h4> 						
  						<table>
  							<tr>
  								<th>[method]</th>
  								<th>param_1</th>
  								<th>param_2</th>
  							</tr>
  							<tr>
  								<td>get</td>
  								<td>1</td>
  								<td>abc</td>
  							</tr>
  							<tr>
  								<td>post</td>
  								<td>2</td>
  								<td>def</td>
  							</tr>
  						</table>
  						<p>* use column name "[method]" to specify your HTTP method</p> 
 						</div>
						
						<div>
  						<h4>Run the test cases</h4>
  						<p>
							From your browser , visit http://${YOUR_HOSTNAME}/${YOUR_CONTROLLER}/test_${YOUR_ACTION} with no params 
  						</p>
  						</div>
  						
 						<div>
  						<h4>Example of test result (HTML)</h4>
  						<img src="images/test_case_html.png"/>
  						</div>
  						
  						<div>
  						<h4>Example of test result (JSON) : json data will be print out as <TABLE></h4>
  						<img src="images/test_case_json.png"/>
  						</div>
  					</li>
				</ol>
			</section>
			<section id="@s_performance">
				<header>Performance Test</header>
				<p>Test tool : ApacheBench</p>
				<code>&gt; ab -c 100 -n 10000 URL</code>
				<table>
					<tr>
						<th>Pattern</th>
						<th>Example URL</th>
						<th>Average Response Time</th>
						<th>Description</th>
					</tr>
					<tr>
						<td>Direct access to php file</td>
						<td>/test.php</td>
						<td>8ms</td>
						<td>test.php is under DocumentRoot<br>
							No session
						</td>
					</tr>
					<tr>
						<td>php file with apache rewrite</td>
						<td>/test.php</td>
						<td>13ms</td>
						<td>test.php is under DocumentRoot/mypath<br>No session</td>
					</tr>
					<tr>
						<td>php file under liberPHP2</td>
						<td>/test.php</td>
						<td>14ms</td>
						<td>test.php is under DocumentRoot/liberProj/<br>No session</td>
					</tr>
					<tr>
						<td><b>liberPHP2</b></td>
						<td>/top/test</td>
						<td><b>27-30</b>ms</td>
						<td>Including (1ms-4ms All-in-one)<br>
							Dispatching (3ms-5ms)<br>
							Load & exec Filters(1ms - 3ms)<br>
							Session start (2-5ms, memcached base)<br>
							Use echo to write HTML code.
							</td>
					</tr>
					<tr>
						<td><b>liberPHP2</b> with embeded HTML Render</td>
						<td>/top/test</td>
						<td><b>32-41</b>ms</td>
						<td>Use Embeded Template engine to render HTML</td>
					</tr>
					<tr>
						<td><b>liberPHP2</b> with Smarty</td>
						<td>/top/test</td>
						<td><b>71</b>ms</td>
						<td>Use Smarty to render HTML</td>
					</tr>
					<tr>
						<td><b>FuelPHP</b> no HTML Render</td>
						<td>Helloword</td>
						<td><b>434</b>ms<br>(As the same level with LiberPHP1.x, archived now)</td>
						<td>
						</td>
					</tr>
					<tr>
						<td><b>CakePHP</b> with Smarty</td>
						<td>/top/test</td>
						<td><b>Timeout</b><br><b>10371</b>ms (c=100,n=100)</td>
						<td>Use Smarty to render HTML<br>
							With default performance options,<br>
							Using .htaccess(default)<br>
							And there is no error on the page.
						</td>
					</tr>
					<tr>
						<td><b>Symphony2</b> with Swig</td>
						<td>standalone toppage</td>
						<td><b>Sorry no response at all</b><br><b>7377</b>ms (c=10,n=10)</td>
						<td>
						</td>
					</tr>
				</table>
			</section>
			<section id="@s_next">
				<header>What's Next?</header>
			</section>
		<footer> @Author : soyoes 2014</footer>
		</article>
	</div>
	
	</body>
</html>